<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="HandheldFriendly" content="true"/>
		<meta name="MobileOptimized" content="320"/>
		<title>Hello H5+</title>
		<script type="text/javascript" src="../js/common.js"></script>
		<script type="text/javascript" src="../js/JPushPlugin.js"></script>
		<script type="text/javascript">

		function jpushReceiveNotification(event){
			var msg = JSON.parse(event.arguments);
			document.getElementById("pushContent").innerHTML = msg.aps.alert;
			console.log("jpushReceiveNotification:" + msg);
			window.setTimeout(function(){
				alert(JSON.stringify(msg));
			},0);
		}
		
		function jpushClickNotification(event){
			jpushReceiveNotification(event);
		}

		function jpushReceiveMessage(event){
			var msg = JSON.parse(event.arguments);
			document.getElementById("diyContent").innerHTML = msg.content;
			console.log("ReceiveMessage:" + msg.content);
			window.setTimeout(function(){
				alert(msg.content);
			},0);
		}
		
		function setTagsAndAlias(){
			var tag1 = document.getElementById("tag1").value;
        		var tag2 = document.getElementById("tag2").value;
        		var alias = document.getElementById("alias").value;
        		var tags = [];
        		if (tag1 != "") {
        			tags.push(tag1);
        		}
        		if (tag2 != "") {
        			tags.push(tag2);
      		}
        		window.plus.jPushPlugin.setTagsWithAlias(tags,alias,function(msg){
        			alert(decodeURIComponent(msg));
        		});
		}
		
		// 监听plusready事件  
		document.addEventListener("plusready", function(){
			window.plus.jPushPlugin.getRegistrationID(function(rid){
				document.getElementById("registrationID").innerHTML = rid;
			});
		}, false );

		document.addEventListener("jpush.receiveNotification",jpushReceiveNotification,false);
		document.addEventListener("jpush.clickNotificcation",jpushClickNotification,false);
		document.addEventListener("jpush.receiveMessage",jpushReceiveMessage,false);

		</script>
		
	<link rel="stylesheet" href="../css/push.css" type="text/css" charset="utf-8"/>
	</head>
	<body>
		<header>
			<div class="nvbt iback" onclick="back(true);"></div>
			<div class="nvtt">Push</div>
			<div class="nvbt idoc" onclick="openDoc('Push Document','/doc/push.html')"></div>
		</header>
		<br />
		<div align="middle" class="label">状态</div>
        <br />
        <span class="title">RegistrationID：</span>
        <span class="title" id="registrationID" class="title">null</span>
        <div align="middle" class="label">Tag/Alias</div>
        <br />
        <p class="title">Tags:</p>
        <input id="tag1" class="input"/>
        <br />
        <input id="tag2" class="input" />
        <br /><br />
        <p class="title">Alias:</p>
        <input id="alias" class="input"/>
        <br />
        <button onclick="setTagsAndAlias()">设置</button>
        <div align="middle" class="label">接收</div>
        <br />
        <span class="title">推送内容：</span>
        <span class="title" id="pushContent">null</span>
        <br />
        <span class="title">自定义内容：</span>
        <span class="title" id="diyContent">null</span>
        
	</body>
</html>